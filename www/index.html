<!DOCTYPE html>
<html lang="ru">
<head>
    	<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    	<title>Диспетчер СУ</title>
    	
<!-- JS -->     	
    	<!-- React -->
	<script src="scripts/react/unpkg.com_react@18.2.0_umd_react.production.min.js"></script>
	<script src="scripts/react/unpkg.com_react-dom@18.2.0_umd_react-dom.production.min.js"></script>
	<script src="scripts/react/unpkg.com_@babel_standalone@7.22.9_babel.min.js"></script>
	<!-- My React components -->
	<script type="text/babel" src="/scripts/react/button_components.js"></script>
	<script type="text/babel" src="/scripts/react/container_components.js"></script>
	<script type="text/babel" src="/scripts/react/line_components.js"></script>
	
	<script type="text/babel" src="/scripts/react/navigation_components.js"></script>
	<script type="text/babel" src="/scripts/react/panel_components.js"></script>
	<script type="text/babel" src="/scripts/react/form_components.js"></script>
	<script type="text/babel" src="/scripts/react/page_components.js"></script>
	<script type="text/babel" src="/scripts/react/main_components.js"></script>
	<script type="text/babel" src="/scripts/react/wasm_components.js"></script>
	
	<!-- React Router -->
	<script src='https://unpkg.com/react-router-dom@5.0.0/umd/react-router-dom.min.js'></script>
	
	<!-- AJAX -->
	<script src="/scripts/ajax/ajax.googleapis.com_ajax_libs_jquery_2.2.0_jquery.min.js"></script> 

	<!-- sevenSeg -->
	<script src="/scripts/sevenSeg/jquery-ui.min.js"></script>
	<script src="/scripts/sevenSeg/ajax.aspnetcdn.com_ajax_knockout_knockout-2.2.1.js"></script>
	<script src="/scripts/sevenSeg/sevenSeg.js"></script>

	<!-- Terminal -->
	<script src="/scripts/terminal/xterm.js"></script>
	<script src="/scripts/terminal/attach.js"></script>
	<script src="/scripts/terminal/fit.js"></script>
	<script defer src="/scripts/terminal/terminal.js"></script>

	<!-- Bootstrap -->
	<script src="/scripts/bootstrap/bootstrap.bundle.min.js"></script>
    	
    <!-- Wasm -->
    <script src="/scripts/wasm/wasm_exec.js"></script>
    <script src="/scripts/wasm/instantiateWasm.js"></script>
    
    
    	
<!-- CSS -->    	
    	<!-- Bootstrap -->
	<link rel="stylesheet" href="/css/bootstrap/bootstrap.min.css" />
    	
	<!-- Terminal -->
    	<link rel="stylesheet" href="/css/terminal/xterm.css" />
    	<link rel="stylesheet" href="/css/terminal/style.css" />  
    	
    	<!-- My styles -->
    	<link rel="stylesheet" href="/css/styles.css" />  
</head>
  
<body>
<div id="application"></div>

<canvas id="cnvs" width="640" height="480"></canvas>
<script>
const go = new Go();

const runWasm = async () => {
  const importObject = go.importObject;
  const wasmModule = await wasmBrowserInstantiate("wasm_GUI.wasm", importObject);
  go.run(wasmModule.instance);

  // Get our exports object, with all of our exported Wasm Properties
  const exports = wasmModule.instance.exports;

  // Get our memory object from the exports
  const memory = exports.memory;

  // Create a Uint8Array to give us access to Wasm Memory
  const wasmByteMemoryArray = new Uint8Array(memory.buffer);

  // Get the pointer (index) to where our graphics buffer is located in wasm linear memory
  const graphicsBufferPointer = exports.getGraphicsBufferPointer();
  const graphicsBufferSize = exports.getGraphicsBufferSize();

  const canvasElement = document.querySelector("canvas");
  const canvasContext = canvasElement.getContext("2d");
  const canvasImageData = canvasContext.createImageData(canvasElement.width, canvasElement.height);
  
  canvasElement.onclick = function() {
  		exports.eventClick(event.offsetX, event.offsetY);
	}

  // Clear the canvas
  canvasContext.clearRect(0, 0, canvasElement.width, canvasElement.height);

  const drawCheckerBoard = () => {
    const checkerBoardSize = 20;

    // Generate a new checkboard in wasm
    exports.generateCheckerBoard();

    // Pull out the RGBA values from Wasm memory, the we wrote to in wasm,
    // starting at the checkerboard pointer (memory array index)
    const imageDataArray = wasmByteMemoryArray.slice(graphicsBufferPointer, graphicsBufferPointer + graphicsBufferSize);
    canvasImageData.data.set(imageDataArray);

    canvasContext.clearRect(0, 0, canvasElement.width, canvasElement.height);
    canvasContext.putImageData(canvasImageData, 0, 0);
  };

  //drawCheckerBoard();
  setInterval(() => {
    drawCheckerBoard();
  }, 150);
};
runWasm();
</script> 

<!-- My scripts --> 
<script>
	// Сохраняем все параметры полученные от Web-сервера
	let UserName = "Test";//"{{ .UserName }}"; 
	let BackLink = "{{ .BackLink }}";
	console.log(UserName);
</script> 

<script src="/scripts/longpoll.js"></script>
<script src="/scripts/functions.js"></script>
<script src="/scripts/messages.js"></script>

<script type="text/babel" src="/scripts/app.js"></script>

</body>	
</html>

